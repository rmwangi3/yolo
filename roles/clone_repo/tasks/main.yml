---
- name: Create application directory
  file:
    path: "{{ app_directory }}"
    state: directory
    mode: '0755'

- name: Clone repository
  git:
    repo: "{{ github_repo }}"
    dest: "{{ app_directory }}"
    version: "{{ github_branch }}"
    force: yes

- name: Create image upload directory
  file:
    path: "{{ image_upload_path }}"
    state: directory
    mode: '0755'
    recurse: yes

- name: Create backend .env file
  copy:
    content: |
      MONGODB_URI={{ mongodb_uri }}
      PORT={{ backend_port }}
    dest: "{{ app_directory }}/.env"
    mode: '0644'

- name: Display cloned repository information
  debug:
    msg:
      - "Repository cloned successfully to {{ app_directory }}"
      - "Branch: {{ github_branch }}"
      - "Environment file created"
  tags:
    - repo-info
