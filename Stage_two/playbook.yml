---
<<<<<<< HEAD
- name: Deploy YOLO E-commerce Application with Docker (Stage 2)
  hosts: yolo_server
  become: yes
  gather_facts: yes

=======
- name: Terraform and Ansible Integration - YOLO Deployment
  hosts: localhost
  connection: local
  gather_facts: no

  tasks:
    - name: Initialize Terraform
      command: terraform init
      args:
        chdir: terraform
      register: tf_init

    - name: Apply Terraform configuration
      command: terraform apply -auto-approve
      args:
        chdir: terraform
      register: tf_apply

    - name: Display Terraform output
      command: terraform output -json
      args:
        chdir: terraform
      register: tf_output

    - name: Show deployment info
      debug:
        msg:
          - "Terraform provisioning completed"
          - "VM IP: 192.168.56.10"
          - "Frontend: http://192.168.56.10:3000"
          - "Backend: http://192.168.56.10:5000/api/products"

- name: Configure application via Ansible
  hosts: all
  become: yes
>>>>>>> master
  vars_files:
    - ../vars/main.yml

  roles:
<<<<<<< HEAD
    - role: ../roles/docker
      tags: docker
    
    - role: ../roles/clone_repo
      tags: clone
    
    - role: ../roles/mongodb
      tags: mongodb
    
    - role: ../roles/backend
      tags: backend
    
    - role: ../roles/client
      tags: client

  post_tasks:
    - name: Verify all containers are running
      block:
        - name: Check running containers
          command: docker ps
          register: containers_status
          tags: verify

        - name: Display container status
          debug:
            msg: "{{ containers_status.stdout_lines }}"
          tags: verify

        - name: Wait for application to be ready
          wait_for:
            host: localhost
            port: 3000
            delay: 10
            timeout: 60
          tags: verify

        - name: Display deployment success message
          debug:
            msg: "Application deployed successfully! Access at http://localhost:3000"
          tags: verify
=======
    - { role: ../roles/docker, tags: [docker] }
    - { role: ../roles/clone_repo, tags: [clone] }
    - { role: ../roles/mongodb, tags: [mongodb] }
    - { role: ../roles/backend, tags: [backend] }
    - { role: ../roles/client, tags: [client] }
>>>>>>> master
